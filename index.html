<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Hello World!</title>
    
    <style>
        * { margin:0; padding:0; } /* to remove the top and left whitespace */
      
      html, body { width:100%; height:100%; 
          background: rgba(238, 238, 238, 0.507);} /* just to be sure these are full screen*/
      
      canvas { display:block; 
          background: rgba(238, 238, 238, 0);} /* To remove the scrollbars */
      
      div {
          position: absolute;
          top: 20px;
          left: 20px;
          width: 200px;
          height: 200px;
          overflow:auto;
          resize:both;
          background-color:rgba(0, 255, 255, 0);
      }
        </style>

    
    </head>
<body>
    <div style="background-color:rgba(0, 255, 255, 0)" id="mydiv">
        <canvas style="border:1px solid rgba(128, 128, 128, 0);" id="mycanvas">

        </canvas>
    </div>
      
    <!-- All of the Node.js APIs are available in this renderer process. -->
    <p id='word1'>start!</p>,<p id='mean1'>여기는 뜻이 나오는 자리</p>
    <!--<script type="text/javascript" src="test.js">  </script>-->

  
    <script>
      // You can also require other files to run in this process
      require('./renderer.js');
      const testJS = require('./test.js');
      //setInterval(testJS.resizeCanvasDiv, 2000);

      require('electron').ipcRenderer.on('word1Change', function(event, inText) {
        document.getElementById('word1').innerHTML = inText;
      });
      require('electron').ipcRenderer.on('mean1Change', function(event, inText) {
        document.getElementById('mean1').innerHTML = inText;        
      });

      //------------------------------
    
      var mydiv = document.getElementById('mydiv');
//       var stage = new createjs.Stage("canvasH");
//       createjs.Ticker.on("tick", tick);
//       stage.addChild(mydiv);

// function tick(event) {
//     stage.update(event);
//}      
var img = new Image();
    var lastImageBlob
    //var mydiv = document.getElementById('mydiv');
    var canvas = document.getElementById('mycanvas'), context = canvas.getContext('2d');


    var elementResizeEvent = require('element-resize-event');
 
 //var element = document.getElementById("resize");
  
 elementResizeEvent(mydiv, resizeCanvasDiv);
 //elementResizeEvent(canvas, resizeCanvas);

    function resizeCanvasDiv() {
         console.log("\n resizeCanvasDiv() \n");
        // //document.getElementById('word1').innerHTML = "resizeCanvasDiv()";
        //   var canvas = document.getElementById("mycanvas");
        //   var ctx = canvas.getContext('2d');
        //   var mydiv = document.getElementById('mydiv');

            //  canvas.width = mydiv.innerWidth;
            //  canvas.height = mydiv.innerHeight;

             resizeCanvas();

        //stage.update();

            
    }

    function resizeCanvas()
    {
        console.log("\n resizeCanvas() \n");
        //document.getElementById('word1').innerHTML = "resizeCanvas()";
        /**
         * Your drawings need to be inside this function otherwise they will be reset when 
         * you resize the browser window and the canvas goes will be cleared.
         */            
         if (lastImageBlob)
        {
    //       console.log("\n resizeCanvas() lastImageBlob\n");
    //         //var mydiv = document.getElementById('mydiv');
    //     //var canvas = document.getElementById("mycanvas");
    //     //var ctx = canvas.getContext('2d');
    //     var canvas = document.getElementById("mycanvas");
    //       var ctx = canvas.getContext('2d');
    //     // Create an image to render the blob on the canvas
    //     //var img = new Image();

    //     // Once the image loads, render the img on the canvas
    // //     img.onload = function(){
    // //         // Update dimensions of the canvas with the dimensions of the image
    // //         console.log("\n resizeCanvas() onload" + img.width);


    // // // set size proportional to image
    // // canvas.height = canvas.width * (img.height / img.width);

    // // // step 1 - resize to 50%
    // // var oc = document.createElement('canvas'),
    // //     octx = oc.getContext('2d');

    // // oc.width = img.width * 0.5;
    // // oc.height = img.height * 0.5;
    // // octx.drawImage(img, 0, 0, oc.width, oc.height);

    // // // step 2
    // // octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);

    // // step 3, resize to final size
    // ctx.drawImage(img, 0, 0, canvas.clientWidth, canvas.clientHeight);  

    // //     };

    //     // Crossbrowser support for URL
         var URLObj = window.URL || window.webkitURL;

        // Creates a DOMString containing a URL representing the object given in the parameter
        // namely the original Blob
        img.src = URLObj.createObjectURL(lastImageBlob);
        }
    }

    /**
 * This handler retrieves the images from the clipboard as a blob and returns it in a callback.
 * 
 * @param pasteEvent 
 * @param callback 
 */
 function retrieveImageFromClipboardAsBlob(pasteEvent, callback){

  console.log("\n retrieveImageFromClipboardAsBlob \n");
	if(pasteEvent.clipboardData == false){
        if(typeof(callback) == "function"){
            callback(undefined);
        }
    };

    var items = pasteEvent.clipboardData.items;

    if(items == undefined){
        if(typeof(callback) == "function"){
            callback(undefined);
        }
    };

    for (var i = 0; i < items.length; i++) {
        // Skip content if not image
        if (items[i].type.indexOf("image") == -1) continue;
        // Retrieve image on clipboard as blob
        var blob = items[i].getAsFile();

        if(typeof(callback) == "function"){
            callback(blob);
        }
    }
}      

window.addEventListener("paste", function(e){

// Handle the event
retrieveImageFromClipboardAsBlob(e, function(imageBlob){
    // If there's an image, display it in the canvas
    if(imageBlob){
      lastImageBlob = imageBlob;
        var canvas = document.getElementById("mycanvas");
        var ctx = canvas.getContext('2d');
        var mydiv = document.getElementById('mydiv');
        
        // Create an image to render the blob on the canvas
        // Once the image loads, render the img on the canvas
        img.onload = function(){
          console.log("\n img onload() " + mydiv.clientWidth+"\n");
            // Update dimensions of the canvas with the dimensions of the image
            canvas.width = mydiv.clientWidth;
            canvas.height = mydiv.clientHeight;

            // Draw the image
            ctx.drawImage(img, 0, 0, mydiv.clientWidth, mydiv.clientHeight);

    // // set size proportional to image
    // canvas.height = canvas.width * (img.height / img.width);

    // // step 1 - resize to 50%
    // var oc = document.createElement('canvas'),
    //     octx = oc.getContext('2d');

    // oc.width = img.width * 0.5;
    // oc.height = img.height * 0.5;
    // octx.drawImage(img, 0, 0, oc.width, oc.height);

    // // step 2
    // octx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5);

    // // step 3, resize to final size
    // ctx.drawImage(oc, 0, 0, oc.width * 0.5, oc.height * 0.5,
    // 0, 0, canvas.width, canvas.height);            
        };

        // Crossbrowser support for URL
        var URLObj = window.URL || window.webkitURL;

        // Creates a DOMString containing a URL representing the object given in the parameter
        // namely the original Blob
        img.src = URLObj.createObjectURL(imageBlob);

        //ctx.drawImage(img, 0, 0);
    }
});
}, false);      
      //------------------------------------
    </script>
  </body>
</html>
